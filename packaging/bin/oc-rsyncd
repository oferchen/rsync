#!/bin/sh
set -eu

wrapper="$0"
case "$wrapper" in
  */*) ;;
  *) wrapper="$(command -v -- "$wrapper" 2>/dev/null || printf '%s' "$wrapper")" ;;
esac

wrapper_dir="$(dirname -- "$wrapper")"
case "$wrapper_dir" in
  /*) ;;
  *) wrapper_dir="$(cd "$wrapper_dir" 2>/dev/null && pwd -P)" ;;
esac

candidate="$wrapper_dir/oc-rsync"
if [ -x "$candidate" ]; then
  exec "$candidate" --daemon "$@"
fi

if command -v oc-rsync >/dev/null 2>&1; then
  exec "$(command -v oc-rsync)" --daemon "$@"
fi

echo "oc-rsyncd wrapper could not locate oc-rsync binary" >&2
exit 127
